<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
  <title>dealz</title>
  <link rel="stylesheet" type="text/css" href="dealz.css" />
  <script src="http://ajax.aspnetcdn.com/ajax/jQuery/jquery-2.1.1.min.js">
  </script>
  <script src="http://ajax.aspnetcdn.com/ajax/signalr/jquery.signalr-2.1.0.min.js">
  </script>
  <script src="http://d3js.org/d3.v3.min.js">
  </script>
</head>
<body>
  <div id="analysis">
    <section id="tickz">
      <div>
        <button id="follow">Follow MSFT</button>
        <button id="forget">Forget MSFT</button>
      </div>
      <input type="text" id="tickz_out" />
    </section>
    <section id="valuz">
      <div>
        <button id="reckon">Price Order</button>
      </div>
      <input type="text" id="valuz_out" />
    </section>
  </div>
  <section id="chatz">
    <textarea id="users"></textarea>
    <textarea id="chatz_out"></textarea>
    <div>
      <textarea id="jabber_words"></textarea>
    </div>
    <div>
      <button id="jabber">Send Message</button>
    </div>
  </section>
  <script>
  $(function () {
    "use strict";
    var orders = new Array();
    for (var i = 0, j = 1, k = 2; k < 500; i += 3, j += 3, k += 3) {
      orders[i] = { Stock: "MSFT", Action: { Case: "Buy", Fields: [] }, Price: 19.997 };
      orders[j] = { Stock: "APPL", Action: { Case: "Buy", Fields: [] }, Price: 35.765 };
      orders[k] = { Stock: "GOOG", Action: { Case: "Sell", Fields: [] }, Price: 256.004 };
    }
    var trades = { Case: "Reckon", Fields: [orders] };
    var SMALLTRADE = window.JSON.stringify(trades);
    var FOLLOWMSFT = window.JSON.stringify({ Case: "Follow", Fields: ["MSFT"] });
    var FORGETMSFT = window.JSON.stringify({ Case: "Forget", Fields: ["MSFT"] });
    var c = $.connection('signalr');
    c.received(function (msg) {
      switch (msg.Case) {
        case 'Ticked': // of Tick
          $('#tickz_out').val(msg.Fields[0].Price);
          break;
        case 'Memoed': // of Memo
          $('#chatz_out').val(msg.Fields[0].Message);
          break;
        case 'Joined': // of users:string[]
          $('#users').val(msg.Fields[0]);
          break;
        case 'Solved': // of Calc
          $('#valuz_out').val(msg.Fields[0].Value);
          break;
        case 'Disconnect':
          console.log(msg.Case);
          c.stop();
          break
        default:
          if (msg.Fields.length == 0) {
            console.log(msg.Case);
          } else {
            console.log(msg.Fields[0]);
          }
          break;
      }
    })
    .start()
    .done(function () {
      $("#follow").click(function () { c.send(FOLLOWMSFT); });
      $("#forget").click(function () { c.send(FORGETMSFT); });
      $("#jabber").click(function () {
        var inp = $("#jabber_words");
        var txt = inp.val();
        var msg = { Case: "Jabber", Fields: [txt] };
        c.send(window.JSON.stringify(msg));
        inp.val("");
      });
      $("#reckon").click(function () { c.send(SMALLTRADE); });
    });
  });
  </script>
</body>
</html>
