<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
  <title>dealz</title>
  <link rel="stylesheet" type="text/css" href="dealz.css" />
  <script src="http://ajax.aspnetcdn.com/ajax/jQuery/jquery-2.1.1.min.js">
  </script>
  <script src="http://ajax.aspnetcdn.com/ajax/signalr/jquery.signalr-2.1.0.min.js">
  </script>
  <script src="http://d3js.org/d3.v3.min.js">
  </script>
</head>
<body>
  <section id="tickz">
    <div id="stocksChart" />
    <div id="stockValues" />
    <form id="subscribe">
      <label>Stock</label>
      <input type="text" id="stock" />
      <button>+</button>
    </form>
  </section>
  <script>
    $(function () {
      "use strict";
      
      var c = $.connection('signalr');
      c.received(function (msg) {
        switch (msg.Case) {
          case 'Ticked': // of Tick
            $('#tickz_out').val(msg.Fields[0].Price);
            break;
          case 'Memoed': // of Memo
            //TODO: ???
            break;
          case 'Joined': // of users:string[]
            //TODO: ???
            break;
          case 'Solved': // of Calc
            //TODO: ???
            break;
          case 'Disconnect':
            console.log(msg.Case);
            c.stop();
            break
          default:
            var note = msg.Case;
            if (msg.Fields.length > 0) {
              note += ": " + msg.Fields[0];
            }
            console.log(note);
            break;
        }
      })
      .start()
      .done(function () {
        $("#follow").click(function () { c.send(FOLLOWMSFT); });
        $("#forget").click(function () { c.send(FORGETMSFT); });
        $("#jabber").click(function () {
          var inp = $("#jabber_words");
          var txt = inp.val();
          var msg = { Case: "Jabber", Fields: [txt] };
          c.send(window.JSON.stringify(msg));
          inp.val("");
        });
        $("#reckon").click(function () { c.send(SMALLTRADE); });
      });
    });
  </script>
</body>
</html>
