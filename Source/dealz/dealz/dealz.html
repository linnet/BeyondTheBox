<!DOCTYPE html>
<html>
<head>
  <title>dealz</title>
  <script src="http://ajax.aspnetcdn.com/ajax/jQuery/jquery-2.1.1.min.js"></script>
  <script src="http://ajax.aspnetcdn.com/ajax/signalr/jquery.signalr-2.1.0.min.js"></script>
</head>
<body>
  <div>
    <button id="follow">Follow MSFT</button>
    <button id="forget">Forget MSFT</button>
  </div>
  <div>
    <textarea id="jabber_words"></textarea>
  </div>
  <div>
    <button id="jabber">Send Message</button>
  </div>
  <div>
    <button id="reckon">Price Order</button>
  </div>
  <script>
    $(function () {
      "use strict";

      var orders = new Array();
      for (var i=0,j=1,k=2; k<500; i+=3,j+=3,k+=3){
        orders[i] = { Stock: "MSFT", Action: { Case: "Buy" , Fields: [] }, Price:  19.997 };
        orders[j] = { Stock: "APPL", Action: { Case: "Buy" , Fields: [] }, Price:  35.765 };
        orders[k] = { Stock: "GOOG", Action: { Case: "Sell", Fields: [] }, Price: 256.004 };
      }
      var trades = { Case: "Reckon", Fields: [ orders ] }; 
      var SMALLTRADE = window.JSON.stringify(trades);

      var FOLLOWMSFT = window.JSON.stringify({ Case: "Follow", Fields: ["MSFT"] });
      var FORGETMSFT = window.JSON.stringify({ Case: "Forget", Fields: ["MSFT"] });
      
      
      var c = $.connection('signalr');

      c.received(function (msg) {
        switch (msg.Case) {
          case 'Disconnect':
            console.log(msg.Case);
            c.stop();
            break
          default:
            if (msg.Fields.length == 0) {
              console.log(msg.Case);
            } else {
              console.log(msg.Fields[0]);
            }
            break;
        }
      })
       .start()
       .done(function () {
         $("#follow").click(function () { c.send(FOLLOWMSFT); });
         $("#forget").click(function () { c.send(FORGETMSFT); });
         $("#jabber").click(function () {
           var inp = $("#jabber_words");
           var txt = inp.val();
           var msg = { Case: "Jabber", Fields: [txt] };
           c.send(window.JSON.stringify(msg));
           inp.val("");
         });
         $("#reckon").click(function () { c.send(SMALLTRADE); });
       });
    });
  </script>
</body>

</html>
